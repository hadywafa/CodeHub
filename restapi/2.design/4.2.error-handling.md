# âŒ Error Handling (Problem+JSON, Error Codes)

## ğŸ§© Why Error Handling Matters

Imagine you call an API and it replies:

```json
{ "error": "Something went wrong" }
```

ğŸ˜¡ â†’ Not helpful.
What went wrong? Validation? Authentication? Server crash?

ğŸ‘‰ Good APIs **communicate clearly**:

- What failed
- Why it failed
- How to fix it

---

## 1ï¸âƒ£ HTTP Status Codes Recap

- `4xx` â†’ Client messed up ğŸ™ƒ (bad input, unauthorized).
- `5xx` â†’ Server messed up ğŸ’¥ (bug, outage).

**Common ones**:

- **400** Bad Request â†’ malformed request body
- **401** Unauthorized â†’ missing/invalid auth
- **403** Forbidden â†’ no permission
- **404** Not Found â†’ resource doesnâ€™t exist
- **409** Conflict â†’ duplicate resource
- **422** Unprocessable Entity â†’ validation errors
- **500** Internal Server Error â†’ generic server failure
- **503** Service Unavailable â†’ downtime/overload

---

## 2ï¸âƒ£ The `problem+json` Standard (RFC 7807)

Instead of inventing custom formats, use a **standardized error response**.

### Example Response

```http
HTTP/1.1 400 Bad Request
Content-Type: application/problem+json
```

```json
{
  "type": "https://api.example.com/errors/invalid-input",
  "title": "Invalid input",
  "status": 400,
  "detail": "The field 'email' must be a valid email address.",
  "instance": "/users/123"
}
```

### Fields Explained

- **type** â†’ URI that documents the error type
- **title** â†’ Short human-readable summary
- **status** â†’ HTTP status code
- **detail** â†’ Extra info (specific to request)
- **instance** â†’ The specific resource/request that failed

---

## 3ï¸âƒ£ Validation Errors Example

If multiple fields fail, return them all:

```json
{
  "type": "https://api.example.com/errors/validation",
  "title": "Validation Failed",
  "status": 422,
  "errors": {
    "email": "Invalid email format",
    "password": "Password must be at least 8 characters"
  }
}
```

âœ… This helps clients fix **all issues at once**.

---

## 4ï¸âƒ£ Example in Flow

```mermaid
sequenceDiagram
    participant Client
    participant API
    participant DB

    Client->>API: POST /users { "email": "badEmail" }
    API->>DB: (Validation happens before hitting DB)
    API-->>Client: 422 Validation Failed (problem+json)
```

---

## 5ï¸âƒ£ Pro Tips

- âœ… Always use **correct status code** (donâ€™t return 200 with "error").
- âœ… Use **problem+json** for consistency.
- âœ… Include **machine-readable fields** (like `errors.email`) for clients.
- âœ… Hide internal stack traces â†’ never expose DB/stack info.
- âœ… Log detailed errors internally, but return safe, helpful messages externally.
- âœ… Provide a **link in `type`** where developers can read more about that error.

---

## âœ… Recap

- **400-series** â†’ client errors, **500-series** â†’ server errors.
- Use **problem+json (RFC 7807)** for standardized responses.
- Return **validation details** so clients know how to fix requests.
- Keep errors **useful but safe**.

> ğŸ’¡ Good error handling = fewer support tickets + happier developers.
