# 📂 File Uploads & Downloads in REST APIs

Uploading and downloading files in REST APIs isn’t “special” — it’s still just **HTTP requests and responses**. The only difference: instead of sending/receiving plain JSON, you’re moving **binary data** (images, PDFs, videos, etc.).

---

## 1️⃣ Uploading Files

### 🔹 The Flow

1. **Client → Server**: Send an HTTP `POST` or `PUT` request to an endpoint like `/files` or `/users/{id}/avatar`.
2. **Request Body**: File is sent in the body using either:

   - **Multipart/form-data** → most common (used in browsers and APIs).
   - **Raw binary stream** → sometimes used for large uploads.

3. **Headers**: Tell the server what kind of data you’re sending.

   - `Content-Type: multipart/form-data` (form uploads).
   - `Content-Type: application/octet-stream` (raw bytes).

4. **Server**: Receives the stream, validates, stores file, and usually responds with metadata.

### 🔹 Example (REST view)

```ini
POST /files HTTP/1.1
Host: api.example.com
Content-Type: multipart/form-data; boundary=----XYZ

------XYZ
Content-Disposition: form-data; name="file"; filename="resume.pdf"
Content-Type: application/pdf

...binary file content...
------XYZ--
```

**Response:**

```json
{
  "id": "12345",
  "filename": "resume.pdf",
  "url": "https://cdn.example.com/files/12345"
}
```

👉 Notice: the API doesn’t return the file itself, but info (like `id` or `url`) where you can later fetch it.

---

## 2️⃣ Downloading Files

### 🔹 The Flow

1. **Client → Server**: Send an HTTP `GET` request to `/files/{id}` or a direct URL.
2. **Server Response**: Sends file as binary stream.
3. **Headers**: Tell the client what it’s downloading.

   - `Content-Type: application/pdf` (or `image/png`, `application/zip`, etc.)
   - `Content-Disposition: attachment; filename="resume.pdf"` (forces download with a name).

### 🔹 Example (REST view)

```ini
GET /files/12345 HTTP/1.1
Host: api.example.com
```

**Response:**

```ini
HTTP/1.1 200 OK
Content-Type: application/pdf
Content-Disposition: attachment; filename="resume.pdf"

...binary PDF content...
```

👉 Browser sees the `Content-Disposition` header → pops “Save as…” dialog.

---

## 3️⃣ Key Considerations in REST File Handling

- **Size limits** → APIs often restrict max file size (e.g., 5MB for profile pictures).
- **Streaming** → For big files, APIs support **chunked upload** (send in pieces) and **range requests** (download in parts).
- **Security** →

  - Validate file type (avoid malicious uploads).
  - Virus scan if sensitive.
  - Use signed URLs (temporary access links).

- **Metadata vs Binary** → Many APIs separate **metadata in JSON** from the actual binary file.

---

## 4️⃣ Real-World Patterns

- **Upload then retrieve**:

  - `POST /files` → upload.
  - `GET /files/{id}` → download.

- **Upload linked to resource**:

  - `POST /users/{id}/avatar` → upload profile picture.
  - `GET /users/{id}/avatar` → fetch picture.

- **Presigned URLs (common in cloud like AWS S3, Azure Blob)**:

  - API gives you a signed URL → client uploads file directly to storage, skipping the app server.
  - Reduces server load and improves scalability.

---

## 📝 Recap

- Upload → `POST/PUT` with file in body (multipart or binary).
- Download → `GET`, server returns file stream with headers.
- Headers (`Content-Type`, `Content-Disposition`) are critical.
- Advanced: chunked uploads, signed URLs, virus scanning.
