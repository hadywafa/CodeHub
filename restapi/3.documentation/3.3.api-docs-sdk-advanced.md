# üß∞ What is API client SDK generation?

Given an **OpenAPI spec (openapi.yaml/json)**, generators produce **typed client libraries** that:

- expose each endpoint as a method,
- validate inputs,
- serialize/deserialize JSON,
- handle auth headers,
- and often include **retry**, **pagination**, and **error** helpers.

Result: consumers call `client.users.getUser(id)` instead of hand-rolling HTTP.

---

## üîù The main generators (quick map)

| Tool                                             | Best for           | Notes                                                                                |
| ------------------------------------------------ | ------------------ | ------------------------------------------------------------------------------------ |
| **OpenAPI Generator**                            | Most languages     | Community-driven, very active; dozens of generators (ts, csharp, python, java, etc.) |
| **Swagger Codegen**                              | Legacy alt         | Older project; today most use OpenAPI Generator                                      |
| **NSwag**                                        | .NET               | Great C# clients from OpenAPI or from C# controllers                                 |
| **AutoRest**                                     | Azure ecosystem    | Polished C#/TS; extensible via readme.md config                                      |
| **openapi-typescript** + **openapi-fetch/axios** | TS-first apps      | Lightweight types + fetch wrapper                                                    |
| **Redocly**                                      | Commercial tooling | Pipeline, linting, bundling                                                          |

> For most teams: **OpenAPI Generator** is the right default.

---

## üß™ Prerequisites (applies to all)

- Your **openapi.yaml** is valid and linted (e.g., Spectral).
- Endpoints have **operationId** (stable, readable names) ‚Üí better method names.
- Models are under **components/schemas** with **required**, **enums**, **formats**.

Example:

```yaml
paths:
  /users/{id}:
    get:
      operationId: getUser
      parameters: [...]
      responses:
        "200":
          content:
            application/json:
              schema: { $ref: "#/components/schemas/User" }
```

---

## ‚öôÔ∏è Generate SDKs with OpenAPI Generator

Install (any OS, needs Java):

```bash
npm i -g @openapitools/openapi-generator-cli
# or: brew install openapi-generator
```

## 1) TypeScript (axios)

```bash
openapi-generator-cli generate \
  -i openapi.yaml \
  -g typescript-axios \
  -o sdk/ts
```

**Use it:**

```ts
import { Configuration, UsersApi } from "./sdk/ts";
const api = new UsersApi(new Configuration({ basePath: "https://api.example.com", accessToken: "YOUR_TOKEN" }));
const user = await api.getUser(42);
console.log(user.data.name);
```

### TS alt (fetch, lightweight types)

- Types only:

  ```bash
  npx openapi-typescript openapi.yaml -o sdk/ts/types.ts
  ```

- Add a tiny client (e.g., **openapi-fetch**):

  ```bash
  npm i openapi-fetch
  ```

  ```ts
  import createClient from "openapi-fetch";
  import type { paths } from "./sdk/ts/types";
  const client = createClient<paths>({ baseUrl: "https://api.example.com" });
  const { data, error } = await client.GET("/users/{id}", { params: { path: { id: 42 } } });
  ```

## 2) C# (.NET)

```bash
openapi-generator-cli generate \
  -i openapi.yaml \
  -g csharp \
  -o sdk/csharp \
  --additional-properties=packageName=MyApi.Client,targetFramework=net8.0,nullableReferenceTypes=true
```

**Use it:**

```csharp
var config = new MyApi.Client.Client.Configuration { BasePath = "https://api.example.com" };
config.AccessToken = "YOUR_TOKEN";
var users = new MyApi.Client.Api.UsersApi(config);
var user = await users.GetUserAsync(42);
Console.WriteLine(user.Name);
```

**.NET alternative (NSwag):**

```bash
dotnet tool install --global NSwag.Console
nswag openapi2csclient /input:openapi.yaml /classname:UsersClient /namespace:MyApi.Client /output:sdk/csharp/UsersClient.cs
```

## 3) Python (requests)

```bash
openapi-generator-cli generate \
  -i openapi.yaml \
  -g python \
  -o sdk/python
```

**Use it:**

```python
from sdk.python import ApiClient, Configuration
from sdk.python.api.users_api import UsersApi

cfg = Configuration(host="https://api.example.com")
cfg.access_token = "YOUR_TOKEN"
with ApiClient(cfg) as client:
    api = UsersApi(client)
    user = api.get_user(42)
    print(user.name)
```

---

## üîê Authentication in generated SDKs

Define security in OpenAPI:

```yaml
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
security:
  - BearerAuth: []
```

Every generator exposes config to set the token:

- TS Axios: `new Configuration({ accessToken: '...' })`
- C#: `config.AccessToken = "..."` (or ApiKey headers)
- Python: `cfg.access_token = "..."`

API keys:

```yaml
components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
```

---

## üß© Pagination, retries, errors

**Pagination:**

- Document query params (`page`, `size`) and response envelope.
- Optionally add **helper wrappers** in your SDK repo (iterate pages).

**Retries & backoff:**

- Many generators let you inject an HTTP client.

  - TS Axios: pass a configured `axios` with interceptors (retry on 429/503).
  - C#: wrap `HttpClient` with Polly (retry, circuit breaker).
  - Python: `urllib3`/`requests` adapters for retry.

**Error mapping:**

- Standardize errors (problem+json) in the spec.
- Generators create error types or throw `ApiException` with parsed body.

---

## üèóÔ∏è Repo structure (mono or per language)

```ini
/openapi
  openapi.yaml
/sdk
  /ts
  /csharp
  /python
/.github/workflows/sdk.yml
```

- Keep **generated code committed** (so consumers don‚Äôt need the generator), or publish to registries (npm, NuGet, PyPI).

---

## üö¢ Publish your SDKs

**TypeScript:**

```bash
cd sdk/ts
npm version minor
npm publish --access public
```

**C#:**

```bash
cd sdk/csharp
dotnet pack -c Release
dotnet nuget push bin/Release/*.nupkg -k $NUGET_API_KEY -s https://api.nuget.org/v3/index.json
```

**Python:**

```bash
cd sdk/python
python -m build
twine upload dist/*  # needs PYPI token
```

Use **SemVer**:

- breaking ‚Üí `MAJOR`,
- new, backwards-compatible ‚Üí `MINOR`,
- fixes ‚Üí `PATCH`.

---

## ü§ñ Keep SDKs in sync (CI pipeline)

**Trigger** on changes to `openapi.yaml`:

1. Lint spec (Spectral).
2. Generate SDKs.
3. Run SDK unit tests (smoke calls against mock/staging).
4. Publish prerelease (e.g., `-rc.1`) to npm/NuGet/TestPyPI.
5. On tag, publish stable.

**GitHub Actions (sketch):**

```yaml
name: build-sdks
on:
  push:
    paths: ["openapi/**"]
jobs:
  gen:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm i -g @openapitools/openapi-generator-cli @stoplight/spectral-cli
      - run: spectral lint openapi/openapi.yaml
      - run: openapi-generator-cli generate -i openapi/openapi.yaml -g typescript-axios -o sdk/ts
      - run: openapi-generator-cli generate -i openapi/openapi.yaml -g csharp -o sdk/csharp --additional-properties=packageName=MyApi.Client
      - run: openapi-generator-cli generate -i openapi/openapi.yaml -g python -o sdk/python
      # + build & publish steps per language (gated by tags/branches)
```

---

## üß† Best practices (hard-won)

- **Stable `operationId`** names ‚Üí prevents diff noise in SDKs.
- **Split by tags**: large APIs can generate per-tag clients (UsersApi, OrdersApi).
- **Vendor extensions**: many generators honor `x-codegen-*` settings.
- **Examples in spec** ‚Üí power mock servers and better docs.
- **One truth**: never hand-edit generated files; add convenience wrappers in a separate folder/package.
- **Changelogs & diff**: use openapi-diff to flag breaking changes in CI.
- **Sandbox server** in `servers` for SDK tests.

---

## ‚úÖ TL;DR

1. Write & lint **openapi.yaml** (good operationIds, schemas, errors).
2. Run **OpenAPI Generator** for TS/C#/Python.
3. Configure **auth** in generated clients.
4. Add **retries/pagination** via HTTP client hooks.
5. **Publish** to npm/NuGet/PyPI with **SemVer**.
6. Wire **CI** to auto-regenerate on spec changes.
