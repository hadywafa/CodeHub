# ‚úçüèª Hands-on API Docs SDK

## üéØ Goal

- Make a minimal **.NET Web API** with Swagger
- Generate a **TypeScript Angular SDK** from its OpenAPI spec
- Use the SDK inside an **Angular app** (services, models, auth)

---

## 0) Prereqs (once)

- .NET 8 SDK
- Node 18+ & npm
- Angular CLI (`npm i -g @angular/cli`)
- OpenAPI Generator CLI

  ```bash
  npm i -g @openapitools/openapi-generator-cli
  ```

---

## 1) Create a tiny .NET Web API

```bash
mkdir DemoApi && cd DemoApi
dotnet new webapi -n DemoApi
cd DemoApi
```

The template already includes **Swashbuckle** (Swagger). If not, add:

```bash
dotnet add package Swashbuckle.AspNetCore
```

### Add a simple Users endpoint

Create `Models/User.cs`:

```csharp
namespace DemoApi.Models;
public record User(int Id, string Name, string Email);
```

Create `Controllers/UsersController.cs`:

```csharp
using DemoApi.Models;
using Microsoft.AspNetCore.Mvc;

namespace DemoApi.Controllers;

[ApiController]
[Route("api/[controller]")]
public class UsersController : ControllerBase
{
    private static readonly List<User> Users = new()
    {
        new(1, "Ali", "ali@example.com"),
        new(2, "Sara", "sara@example.com")
    };

    [HttpGet("{id:int}")]
    public ActionResult<User> GetUser(int id)
        => Users.FirstOrDefault(u => u.Id == id) is { } user ? Ok(user) : NotFound();

    public record CreateUser(string Name, string Email);

    [HttpPost]
    public ActionResult<User> Create(CreateUser input)
    {
        if (string.IsNullOrWhiteSpace(input.Name) || string.IsNullOrWhiteSpace(input.Email))
            return UnprocessableEntity(new { error = "Name and Email required" });

        var id = Users.Max(u => u.Id) + 1;
        var user = new User(id, input.Name, input.Email);
        Users.Add(user);
        return CreatedAtAction(nameof(GetUser), new { id }, user);
    }
}
```

Ensure Swagger is enabled in `Program.cs` (the template already does this):

```csharp
var builder = WebApplication.CreateBuilder(args);
builder.Services.AddControllers();
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();
var app = builder.Build();

if (app.Environment.IsDevelopment())
{
    app.UseSwagger();
    app.UseSwaggerUI(); // serves /swagger
}

app.UseHttpsRedirection();
app.MapControllers();
app.Run();
```

Run the API:

```bash
dotnet run
```

You should see:

- Swagger UI: `https://localhost:7043/swagger`
- JSON spec: something like `https://localhost:7043/swagger/v1/swagger.json`
  (copy your exact URL from the browser)

---

## 2) Generate the Angular SDK from the live spec

In a **separate** folder (or in your Angular app root):

```bash
# Replace URL with yours
openapi-generator-cli generate \
  -i https://localhost:7043/swagger/v1/swagger.json \
  -g typescript-angular \
  -o ./src/app/api \
  --additional-properties=npmName=@your-org/demo-api,ngVersion=17,providedInRoot=true
```

This creates an Angular-ready SDK under `src/app/api`:

- `apis/` (e.g., `users.service.ts`)
- `models/` (e.g., `user.ts`)
- `configuration.ts` (base URL, auth)
- `api.module.ts` (optional module)

> Tip: If you get a certificate warning for HTTPS localhost, run your API on HTTP for generation, or pass `--server-variables` / add a local cert trust. Alternatively, export the swagger JSON to a file and use `-i openapi.json`.

---

## 3) Wire the SDK into your Angular app

Create app if you don‚Äôt have one:

```bash
ng new demo-client --routing --style=scss
cd demo-client
# move or generate SDK under src/app/api as shown above
```

### Provide base path & (optional) auth

Create `src/app/api/api-config.ts`:

```ts
import { Configuration } from "./api";

export function createApiConfig(): Configuration {
  return new Configuration({
    basePath: "https://localhost:7043", // or environment.apiBase
    accessToken: () => localStorage.getItem("token") || "",
  });
}
```

In `src/app/app.module.ts`:

```ts
import { NgModule } from "@angular/core";
import { BrowserModule } from "@angular/platform-browser";
import { HttpClientModule } from "@angular/common/http";

import { AppComponent } from "./app.component";

// generated SDK module & configuration factory
import { ApiModule, Configuration } from "./api";
import { createApiConfig } from "./api/api-config";

@NgModule({
  declarations: [AppComponent],
  imports: [
    BrowserModule,
    HttpClientModule,
    ApiModule.forRoot(createApiConfig), // <-- wire SDK
  ],
  bootstrap: [AppComponent],
})
export class AppModule {}
```

> If your generator output doesn‚Äôt include `ApiModule`, you can directly provide services and `Configuration` in a core module or via `providers`.

---

## 4) Use the generated service in a component

Open `src/app/app.component.ts`:

```ts
import { Component, OnInit } from "@angular/core";
import { UsersService, User, UsersControllerCreateRequest } from "./api";

@Component({
  selector: "app-root",
  template: `
    <h1>Users Demo</h1>
    <button (click)="loadUser(1)">Load User #1</button>
    <pre>{{ user | json }}</pre>

    <form (ngSubmit)="create()">
      <input [(ngModel)]="name" name="name" placeholder="Name" />
      <input [(ngModel)]="email" name="email" placeholder="Email" />
      <button type="submit">Create</button>
    </form>
    <pre>{{ created | json }}</pre>
  `,
})
export class AppComponent implements OnInit {
  user?: User;
  name = "New User";
  email = "new@example.com";
  created?: User;

  constructor(private users: UsersService) {}

  ngOnInit(): void {}

  loadUser(id: number) {
    this.users.apiUsersIdGet({ id }).subscribe({
      next: (u) => (this.user = u),
      error: (e) => console.error(e),
    });
  }

  create() {
    const body: UsersControllerCreateRequest = { name: this.name, email: this.email };
    this.users.apiUsersPost({ body }).subscribe({
      next: (u) => (this.created = u),
      error: (e) => console.error(e),
    });
  }
}
```

> Method names come from your **OpenAPI operationIds** (or are auto-derived from path/method). If you want beautiful names (e.g., `getUser`, `createUser`), add `operationId` in your spec or via Swashbuckle filters.

Run Angular:

```bash
ng serve
```

Click **Load User #1** ‚Üí you should see Ali. Create a new user via the form ‚Üí the POST endpoint is called via the generated client.

---

## 5) Add Bearer auth (optional)

If your API requires JWT:

**In OpenAPI** (your .NET Swagger):

```csharp
// Program.cs ‚Äì example (Swashbuckle security definition)
builder.Services.AddSwaggerGen(o =>
{
    o.SwaggerDoc("v1", new() { Title = "DemoApi", Version = "v1" });
    o.AddSecurityDefinition("Bearer", new()
    {
        Name = "Authorization",
        Type = Microsoft.OpenApi.Models.SecuritySchemeType.Http,
        Scheme = "bearer",
        BearerFormat = "JWT",
        In = Microsoft.OpenApi.Models.ParameterLocation.Header
    });
    o.AddSecurityRequirement(new()
    {
        {
            new() { Reference = new() { Type = Microsoft.OpenApi.Models.ReferenceType.SecurityScheme, Id = "Bearer" } },
            Array.Empty<string>()
        }
    });
});
```

**In Angular SDK config** (we already did):

```ts
accessToken: () => localStorage.getItem("token") || "";
```

Now all SDK requests carry `Authorization: Bearer <token>`.

---

## 6) Handy tips

- **Pretty method names**: Define `operationId` for each operation in the spec.
  Example via Swashbuckle annotations or filters, or post-process the JSON.
- **Regenerate on changes**: Whenever controllers change, **regenerate** the SDK.
- **Centralize base URL**: Use `environment.ts` for `basePath`.
- **Monorepo**: Keep `DemoApi` and `demo-client` in one workspace; add an npm script to regenerate SDK.

Example npm script (in Angular app `package.json`):

```json
{
  "scripts": {
    "sdk:gen": "openapi-generator-cli generate -i http://localhost:7043/swagger/v1/swagger.json -g typescript-angular -o src/app/api --additional-properties=ngVersion=17,providedInRoot=true"
  }
}
```

---

## 7) What you gained

- **Strongly typed** Angular services & models (no hand-written HTTP calls).
- **Single source of truth** (your .NET Swagger/OpenAPI).
- Faster iteration: change API ‚Üí regenerate ‚Üí Angular stays in sync.
- Easy to add **other SDKs** (C#, Python) with different `-g` flags.
