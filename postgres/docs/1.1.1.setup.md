# Setup Mysql

## Installation

### Setup on VM

#### Linux

```bash
# Install MySQL from root user
apt update && apt full-upgrade -y
apt install mysql-server -y
service mysql start # or  'systemctl start mysql' if systemd is installed
```

#### Windows

```pwsh

```

### Setup on Containers

#### Install on ubuntu container

```bash
####
docker run --rm -it -v $(pwd)/databases:/usr/databases ubuntu:latest bash

# Install MySQL from root user
apt update && apt full-upgrade -y
apt install mysql-server -y
service mysql start # or  'systemctl start mysql' if systemd is installed

# Connect to mysql interactive shell
mysql


####
# cleanup
sudo apt remove mysql-server -y
sudo apt autoremove -y
```

#### Install on mysql-server container

```yaml
version: "3.7"

services:
  pg-db:
    image: postgres
    restart: always
    container_name: pg-db
    hostname: pg-db
    environment:
      POSTGRES_PASSWORD: P@ssw0rd # the username is postgres
    volumes:
      - ./databases:/usr/databases

  adminer:
    image: adminer
    hostname: pg-adminer
    container_name: pg-adminer
    volumes:
      - ./databases:/usr/databases
    restart: always
    ports:
      - 8080:8080

  jupyter:
    image: asami76/allspark:latest
    container_name: jupyter
    hostname: jupyter
    environment:
      - PUID=1000
      - PGID=1000
    volumes:
      - ./databases:/home/jovyan/
    ports:
      - 8888:8888
    restart: unless-stopped

  pgadmin:
    image: dpage/pgadmin4
    hostname: pgadmin
    container_name: pgadmin
    environment:
      PGADMIN_DEFAULT_EMAIL: "ahmed.samy@gmail.com"
      PGADMIN_DEFAULT_PASSWORD: "P@ssw0rd"
    volumes:
      - ./databases:/usr/databases
    restart: always
    ports:
      - "5050:80"
```

```bash
# Use Docker
docker run -d -v /var/run/docker.sock:/tmp/docker.sock -v /etc/hosts:/tmp/hosts asami76/docker-hoster

docker-compose --file 'C:\Users\HadyW\source\repos\Dev\CodeHub\postgres\docs\1.1.2.psql.docker-compose.window.yaml' up -d
```

```bash

```

## Post Installation Tasks

### 1. Connect to PG Server

```bash
# from container
docker exec -it pg-db sh
psql -h pg-db -p 5432 -U postgres
```

```bash
# from host using sql client
psql postgresql://username:password@hostname:5432/dbname
```

### 2. Check Installation

Once you have connected to PostgreSQL using `psql`, you can run the following basic commands to test and interact with the database:

```sql
-- 1. This lists all databases in the PostgreSQL instance.
\l --or \list

-- **2. Connect to a Specific Database**
\c mydatabase;

-- **3. List Tables in the Current Database**
\dt

-- **4. Show Users (Roles)**
\du

-- **5. Show Active Connections**
SELECT datname, usename, client_addr FROM pg_stat_activity;

-- **7. Show Current Database**
SELECT current_database();

-- **8. Show Current User**
SELECT current_user;

-- **9. Show Version of PostgreSQL**
SELECT version();

-- **10. Exit psql**
\q

```

### 3. Restore Databases

```bash
# To restore a database called 'sakila' from a dump file
# Download the dump file from https://dev.mysql.com/doc/index-other.html
# make sure to download the schema and data files
# make sure to change the path to the dump file
SOURCE /usr/databases/sakila-db/sakila-schema.sql;
USE sakila;
SOURCE /usr/databases/sakila-db/sakila-data.sql;
SHOW TABLES FROM sakila;
SELECT * FROM actor LIMIT 10;
DESCRIBE actor;
SHOW COLUMNS FROM actor;
SHOW CREATE TABLE actor\G # \G for better format
```
